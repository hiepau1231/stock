{% extends "base.html" %}
{% load static %}

{% block title %}{{ stock.symbol }} - Chi tiết cổ phiếu{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>{{ stock.symbol }} - {{ stock.company_name }}</h1>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header">
                    Biểu đồ giá
                </div>
                <div class="card-body">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    Thông tin cơ bản
                </div>
                <div class="card-body">
                    <p><strong>Giá hiện tại:</strong> {{ stock.current_price }}</p>
                    <p><strong>Thay đổi:</strong> {{ stock.change }}</p>
                    <p><strong>Khối lượng:</strong> {{ stock.volume }}</p>
                    <p><strong>Ngành:</strong> {{ stock.industry }}</p>
                    <p><strong>Sàn giao dịch:</strong> {{ stock.exchange }}</p>
                </div>
            </div>
        </div>
        <!-- Thêm phần hiển thị chỉ số kỹ thuật -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    Chỉ số kỹ thuật
                </div>
                <div class="card-body">
                    <p><strong>RSI:</strong> {{ technical_indicators.rsi }}</p>
                    <p><strong>MACD:</strong> {{ technical_indicators.macd }}</p>
                    <p><strong>Bollinger Bands:</strong></p>
                    <ul>
                        <li>Upper: {{ technical_indicators.bollinger_bands.upper }}</li>
                        <li>Middle: {{ technical_indicators.bollinger_bands.middle }}</li>
                        <li>Lower: {{ technical_indicators.bollinger_bands.lower }}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header">
                    Dữ liệu lịch sử
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Ngày</th>
                                <th>Giá mở cửa</th>
                                <th>Giá cao nhất</th>
                                <th>Giá thấp nhất</th>
                                <th>Giá đóng cửa</th>
                                <th>Khối lượng</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for data in historical_data %}
                            <tr>
                                <td>{{ data.date }}</td>
                                <td>{{ data.open }}</td>
                                <td>{{ data.high }}</td>
                                <td>{{ data.low }}</td>
                                <td>{{ data.close }}</td>
                                <td>{{ data.volume }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var ctx = document.getElementById('priceChart').getContext('2d');
    var chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ dates|safe }},
            datasets: [{
                label: 'Giá đóng cửa',
                data: {{ prices|safe }},
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: false
                }
            }
        }
    });
</script>
{% endblock %}
